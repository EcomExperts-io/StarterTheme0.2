{% comment %}
  Renders a product card with optional variant swatches

  Accepts:
  - card_product: {Object} Product Liquid object (required)
  - show_vendor: {Boolean} Show the product vendor. Default: false
  - enable_swatches: {Boolean} Enable variant swatches display
  - swatch_trigger: {String} Product option name to use for swatches (e.g., 'Color')
  - swatch_type: {String} Type of swatch to display ('color' or 'image')
  
  
  Example usage:
  {% render 'card-product',
    card_product: product,
    show_vendor: section.settings.show_vendor,
    enable_swatches: section.settings.enable_swatches,
    swatch_trigger: section.settings.swatch_trigger,
    swatch_type: section.settings.swatch_type
  %}
{% endcomment %}

<style>
  .color-swatches {
    display: flex;
    gap: 5px;
    margin: 8px 0;
  }
  .color-swatch {
    width: 30px;
    height: 30px;
    border-radius: 50%;
    border: 1px solid #ddd;
    cursor: pointer;
    transition: transform 0.2s ease;
  }
  .color-swatch.selected {
    border: 2px solid #000;
    transform: scale(1.1);
  }
  .color-swatch:hover {
    transform: scale(1.1);
    border-color: #000;
  }
  .swatch-disabled {
    opacity: 0.5;
    cursor: not-allowed;
    text-decoration: line-through;
  }
</style>

<div class="product-card" data-product-id="{{ card_product.id }}">
  <a href="/products/{{ card_product.handle }}">
    <img
      src="{{ card_product.featured_image | image_url: width: 533 }}"
      alt="{{ card_product.title }}"
      class="product-image"
      width="{{ card_product.featured_image.width }}"
      height="{{ card_product.featured_image.height }}"
      data-product-image="{{ card_product.id }}"
    >
  </a>
  {% if show_vendor %}
    <div class="product-brand">{{ card_product.vendor }}</div>
  {% endif %}

  <div class="product-name">{{ card_product.title }}</div>
  {% if enable_swatches %}
    <div class="color-swatches">
      {%- for option in card_product.options_with_values -%}
        {%- if option.name == swatch_trigger -%}
          {%- for value in option.values -%}
            {%- for variant in card_product.variants -%}
              {%- if variant.options contains value -%}
                <span
                  class="color-swatch"
                  style="{% if swatch_type == 'image' %}background-image: url('{{ variant.featured_image | default: card_product.featured_image | image_url: width: 50 }}'); background-size: cover; background-position: center;{% else %}background-color: {{ value | handleize }};{% endif %}"
                  title="{{ value }}"
                  data-variant-id="{{ variant.id }}"
                  data-variant-image="{{ variant.featured_image | default: card_product.featured_image | image_url: width: 533 }}"
                  data-swatch-color="{{ value | handleize }}"
                  data-swatch
                ></span>
                {%- break -%}
              {%- endif -%}
            {%- endfor -%}
          {%- endfor -%}
        {%- endif -%}
      {%- endfor -%}
    </div>
  {% endif %}
  <div class="product-price">
    <span class="product-original-price">{{ card_product.price_max | money }}</span>
    {{ card_product.compare_at_price | money }}
  </div>
</div>
